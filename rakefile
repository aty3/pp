REPO='https://github.com/aty3/pp.git'


SSH= 'ssh -A -l attila_csender

desc "Run Puppet on ENV['CLIENT']"
task :apply do
	client = ENV['CLIENT']
	sh "git push"
	sh "#{SSH} #{client} pull-updates"

desc "Bootstrap puppet on ENV['CLIENT'] with
	hostname ENV['HOSTNAME']"
task :bootstrap do
	client = ENV['CLIENT']
	hostname = ENV['HOSTNAME'] || client
	commands= <<BOOTSTRAP
		sudo hostname #{hostname} && \
		sudo su - c 'echo #{hostname} > /etc/hostname' && \
		apt-get update && apt-get -y install git puppet && \
		git clone #{REPO} puppet && \
		sudo puppet apply --modulepath=/home/ubuntu/puppet/modules home/ubuntu/puppet/manifests/
BOOTSTRAP
	sh "#{SSH} #{client} '#{commands}'"
end
